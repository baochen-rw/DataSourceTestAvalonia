<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:local="clr-namespace:DataSourceTestAvalonia"
    mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
    x:Class="DataSourceTestAvalonia.MainWindow"
    Title="Data Source Test Tool">
    <Grid Margin="10" RowDefinitions="Auto,Auto,Auto,Auto,Auto,2*,1*,1*,Auto">

        <!-- Title -->
        <TextBlock Grid.Row="0" Text="Data Source Test Tool" FontSize="20"
            FontWeight="Bold"
            HorizontalAlignment="Center" Margin="0,0,0,10" />

        <!-- Status Section -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10"
            Margin="0,0,0,10">
            <TextBlock x:Name="StatusText" Text="Server: Initializing..." FontWeight="Bold" />
            <TextBlock x:Name="ClientStatusText" Text="Client: Not Connected" />
            <Button x:Name="BrowseClientButton" Content="Browse Client" Width="120" />
            <Button x:Name="ClientButton" Content="Start Client" Width="100" IsEnabled="False" />
            <Button x:Name="ResendMessageButton" Content="Resend Messages" Width="130"
                IsEnabled="False" />
            <Button x:Name="ClearSessionButton" Content="Clear Session" Width="110" />
            <Button x:Name="NewKzbButton" Content="New KZB" Width="100"
                IsEnabled="False" />
            <Button x:Name="ThemeToggleButton" Content="ðŸŒ™ Dark" Width="80"
                ToolTip.Tip="Toggle between Light and Dark theme" />
            <TextBlock x:Name="XmlDirectoryLabel" Width="400" Text="No client selected"
                VerticalAlignment="Center" Padding="5"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding Text, RelativeSource={RelativeSource Self}}">
                <TextBlock.ContextMenu>
                    <ContextMenu>
                        <MenuItem x:Name="OpenFolderMenuItem" Header="Open Folder" />
                    </ContextMenu>
                </TextBlock.ContextMenu>
            </TextBlock>
        </StackPanel>

        <!-- Control Panel -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10"
            Margin="0,0,0,10">
            <ComboBox x:Name="ModuleComboBox" Width="120" PlaceholderText="Module" />
            <TextBox x:Name="InterfaceNameTextBox" Width="200" Watermark="Interface Name Filter" />
            <ToggleButton x:Name="ShowOnlyPinnedButton" Content="ðŸ“Œ Show Pinned Only" Width="140"
                ToolTip.Tip="Toggle to show only pinned interfaces" />
            <Button x:Name="ClearPinsButton" Content="ðŸ—‘ï¸ Clear Pins" Width="100"
                ToolTip.Tip="Clear all pinned interfaces" />
            <ComboBox x:Name="PreconditionComboBox" Width="150" PlaceholderText="Precondition" />
            <Button x:Name="LoadPreconditionButton" Content="Load" Width="50" />
            <Button x:Name="ScreenshotButton" Content="Screenshot" Width="100" />
            <Button x:Name="CopyDllButton" Content="Copy DLL Files" Width="150" />
            <Button x:Name="CopyClientButton" Content="Client.exe" Width="160"
                Background="LightGreen" />
        </StackPanel>

        <!-- KZB File Watcher Panel -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
            <CheckBox x:Name="KzbWatchCheckBox" Content="ðŸ“‚ Watch KZB Folder:" FontWeight="Bold"
                VerticalAlignment="Center" />
            <Button x:Name="BrowseKzbWatchButton" Content="Browse..." Width="80" />
            <TextBlock x:Name="KzbWatchFolderLabel" Width="300" Text="No folder selected"
                VerticalAlignment="Center" Padding="5"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding Text, RelativeSource={RelativeSource Self}}" />
            <TextBlock x:Name="KzbWatchStatusLabel" Text="ðŸ”´ Inactive" VerticalAlignment="Center"
                FontWeight="Bold" Foreground="DarkRed" />
        </StackPanel>

        <!-- Common Messages Panel -->
        <StackPanel Grid.Row="4" Orientation="Vertical" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,5">
                <TextBlock Text="ðŸ”¥ Most Used Messages:" FontWeight="Bold" FontSize="14"
                    VerticalAlignment="Center" Foreground="DarkOrange" />
                <Button x:Name="RefreshMessagesButton" Content="â†» Refresh" Width="80" FontSize="11" />
                <Button x:Name="ClearHistoryButton" Content="ðŸ—‘ï¸ Clear" Width="80" FontSize="11" />
            </StackPanel>
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                VerticalScrollBarVisibility="Disabled" MaxHeight="80">
                <WrapPanel x:Name="CommonMessagesPanel" Orientation="Horizontal">
                    <!-- Common message buttons will be added here dynamically -->
                </WrapPanel>
            </ScrollViewer>
        </StackPanel>

        <!-- Main Data Grid -->
        <DataGrid Grid.Row="5" x:Name="XmlDataGrid" Margin="0,0,0,10"
            IsReadOnly="False"
            CanUserReorderColumns="True" CanUserResizeColumns="True" CanUserSortColumns="True"
            AutoGenerateColumns="False"
            x:DataType="local:XmlDataItem">
            <DataGrid.Columns>
                <!-- Pin Column -->
                <DataGridTemplateColumn Header="ðŸ“Œ" Width="50" IsReadOnly="False">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="local:XmlDataItem">
                            <CheckBox IsChecked="{Binding IsPinned, Mode=TwoWay}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                ToolTip.Tip="Pin/Unpin this interface" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- File Name Column -->
                <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="120" />

                <!-- Name Column -->
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />

                <!-- Type Column -->
                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80" />

                <!-- Value Column -->
                <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="150"
                    IsReadOnly="False" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- Session Changes Panel -->
        <StackPanel Grid.Row="6" Orientation="Vertical" Margin="0,0,0,10">
            <TextBlock Text="ðŸ“ Session Changes" FontWeight="Bold" FontSize="16" Margin="0,0,0,5"
                Foreground="DarkBlue" />
            <Border BorderBrush="DarkBlue" BorderThickness="2" CornerRadius="5"
                Background="AliceBlue" Padding="5">
                <ScrollViewer VerticalScrollBarVisibility="Visible"
                    HorizontalScrollBarVisibility="Auto"
                    MaxHeight="200">
                    <ItemsControl x:Name="SessionChangesItemsControl">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="4" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="local:XmlDataItem">
                                <Border Background="White" BorderBrush="LightBlue"
                                    BorderThickness="1"
                                    CornerRadius="3" Margin="1" Padding="5">
                                    <StackPanel Orientation="Vertical" Spacing="2">
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold"
                                            Foreground="DarkBlue" FontSize="12"
                                            TextTrimming="CharacterEllipsis" />
                                        <StackPanel Orientation="Horizontal" Spacing="3">
                                            <TextBlock Text="File:" FontWeight="SemiBold"
                                                Foreground="Gray" FontSize="10" />
                                            <TextBlock Text="{Binding FileName}" Foreground="Black"
                                                FontSize="10"
                                                TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="3">
                                            <TextBlock Text="Type:" FontWeight="SemiBold"
                                                Foreground="Gray" FontSize="10" />
                                            <TextBlock Text="{Binding Type}" Foreground="Black"
                                                FontSize="10" />
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="3">
                                            <TextBlock Text="Value:" FontWeight="SemiBold"
                                                Foreground="Green" FontSize="10" />
                                            <TextBlock Text="{Binding Value}" Foreground="DarkGreen"
                                                FontSize="11"
                                                FontWeight="Bold" TextWrapping="Wrap"
                                                TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </StackPanel>

        <!-- Warnings List -->
        <ScrollViewer Grid.Row="7" x:Name="WarningsScrollViewer">
            <ListBox x:Name="WarningListBox" />
        </ScrollViewer>

    </Grid>
</Window>